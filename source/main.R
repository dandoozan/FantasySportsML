#-FP
  #-lm: 8.467974/0.5618366, $6, 22/19, 8.782964/9.413117/10.07835, 8.853081/9.516436/10.22786, 0.9280349
  #-rf: 74.95838/54.1907, -$26, 14/27, 8.919633/9.49134/10.13863, 8.853081/9.482955/9.907983, 0.9027574
  #-xgb: 8.117828/8.539503, -$10, 18/23, 8.810508/9.428531/10.56384, 8.853081/9.520029/10.74696, 0.9185181
  #-avg: -$14, 17/24, 8.775143/9.38517/10.35277, 8.853081/9.510263/10.48588, 0.9198568
#-FP/Min
  #-lm: 0.2813915/0.293635, 6.754258/0.609909, -$26, 14/27, 8.752874/9.505392/10.80481, 8.853081/9.564041/10.75847, 0.902947
  #-rf: 0.0822888/26.58138, 46.46401/60.26434, -$18, 16/25, 8.806318/9.604046/9.886554, 8.853081/9.591684/10.15668, 0.9117763
  #-xgb: 0.271234/0.283515, 6.404378/6.747545, -$10, 18/23, 8.778643/9.560846/9.634787, 8.853081/9.583978/9.512432, 0.9233148
  #-avg: -$2, 20/21, 8.708141/9.481084/10.40536, 8.853081/9.582554/10.61154, 0.9131658


#-use combination of MAX_COVS, floor, ceil, hillClimbing numTries, startDate to get good prediction
#-gblinear might be slightly better but it takes longer and plotImportances doesn't work, so use gbtree for now
#-remove 10/26 and add RG Offense Vs Defense Advanced
#-remove F.RG.ADVANCEDPLAYERSTATS bc there are too many NAs
#-increase numTries in createTeam_HillClimbing to get a better hill climbing team
#-rescrape all nba data to get updated stats
#-make sure 11/20 has all data for all players and teams that played that day since I scraped it late
#-maybe only use data from 11/5 onward or only the last X (2?) weeks
#-use RG_points51 as a feature
#-only play on days that I am highly confident that I'll win
#-only play players who have greater than X (5%?) pownpct level
#-use meanFpWhenPlayed instead of meanFpWhenAvailableToPlay

rm(list = ls())
setwd('/Users/dan/Desktop/ML/df')
source('source/lm_2016.R')
source('source/rf_2016.R')
source('source/xgb_2016.R')

source('source/_main_common.R')

#Globals
PROD_RUN = F
NUMBER = '87'
NAME = 'retune'
FILENAME = paste0(NUMBER, '_', NAME)
METHOD = 'FP'

PLOT_ALG = ''
PLOT = 'bal' #fi, bal, scores, cv, rmses
MAKE_TEAMS = T #PROD_RUN || PLOT_ALG == '' || PLOT == 'scores' || PLOT == 'multiscores' || PLOT == 'bal'

METHODS = list(
  FP=list(
    printModelResults=printModelResultsFp,
    createPrediction=createPredictionFp,
    printErrors=printErrorsFp,
    yNameToPlot=FP_NAME,
    xNamesToPlot=getFeaturesToUseFp()
  ),
  FpPerMin=list(
    printModelResults=printModelResultsFpPerMin,
    createPrediction=createPredictionOfFpUsingFpPerMin,
    printErrors=printErrorsFpPerMin,
    yNameToPlot=MINUTES_NAME,
    xNamesToPlot=getFeaturesToUseMinutes()
  ),
  FpByPlayer=list(
    printModelResults=NULL,
    createPrediction=createPredictionFpByPlayer,
    printErrors=NULL,
    yNameToPlot=FP_NAME,
    xNamesToPlot=getFeaturesToUseFpByPlayer()
  )
)

#================= Main =================

data = getData(START_DATE, END_DATE)
amountToAddToY = 0#computeAmountToAddToY(data, Y_NAME)
runAlgs(ALGS, data, METHODS[[METHOD]]$printModelResults, METHODS[[METHOD]]$createPrediction, METHODS[[METHOD]]$printErrors, yNameToPlot=METHODS[[METHOD]]$yNameToPlot, xNamesToPlot=METHODS[[METHOD]]$xNamesToPlot, amountToAddToY)
cat('Done!\n')

nov23 = function() {
  #-Use rmse, logy (RG_points, NF_FP):
    #-lm: 0.5631245/0.4433804, 10.36607/10.85297/10.36518, Inf, -$8, 6/10, 10.40135/12.62814/18.09946, 0.9195618
    #-rf: 0.3303115/42.00708, 5.427849/9.789181/5.56946, Inf, $0, 8/8, 9.702848/10.49211/9.877602, 0.9344018
    #-xgb: 0.521395/0.541843, 8.886824/9.610087/9.004735, Inf, $16, 12/4, 9.403513/10.75018/9.756688, 0.9792446
  #-Use rmse, y (RG_points, NF_FP):
    #-avg lm,rf,xgb: Inf, $0, 8/8, 8.911384/9.724416/8.850527, 0.9430924
    #-avg rf,xgb: Inf, $12, 11/5, 9.040202/9.854665/8.601371, 0.9622822
    #-lm: 8.80294/0.5589454, 8.704673/9.173929/8.79985, Inf, -$8, 6/10, 8.830848/9.546116/10.05835, 0.9280507
    #-rf: 87.61809/50.11933, 5.025854/9.693496/5.134203, Inf, $8, 10/6, 9.410472/10.19983/9.351791, 0.9394312
    #-xgb: 8.502619/8.841369, 8.419662/9.240263/8.552652, Inf, $0, 8/8, 8.921783/9.705028/8.938733, 0.941946
  #-Add RG_B2B_Situation (RG_points, NF_FP, RG_B2B_Situation)
    #-avg lm,rf,xgb: Inf, $4, 9/7, 8.879408/9.647899/8.858755, 0.9620178
    #-avg rf,xgb: Inf, $8, 10/6, 8.946522/9.769628/8.768158, 0.9656892
    #-lm: 8.806513/0.5585873, 8.696876/9.224006/8.799298, Inf, -$4, 7/9, 8.835524/9.575473/10.0197, 0.9381837
    #-rf: 79.60645/54.68033, 7.198116/9.281684/7.459201, Inf, $12, 11/5, 9.037646/9.813199/8.677962, 0.9525361
    #-xgb: 8.493006/8.84734, 8.420464/9.224434/8.552002, Inf, -$8, 6/10, 8.931399/9.738053/9.080101, 0.9281627
}
dec3Fp = function() {
#dec3:
  #-RG_points, NF_FP (2/271)
    #-lm: 8.838534/0.5591056, -$10, 10/15, 8.82233/9.59527/10.46505, 0.9163022
    #-rf: 89.63814/49.40082, -$2, 12/13, 9.434458/10.21069/10.11951, 0.9142227
    #-xgb: 8.611697/8.892585, -$2, 12/13, 8.911271/9.646003/9.649063, 0.9287583
    #-avg: Inf, -$6, 11/14, 8.914961/9.747728/9.599471, 0.9237973
  #-Add MeanFP (RG_points, NF_FP, MeanFP) (3/271)
    #-lm: 8.83662/0.5592965, -$14, 9/16, 8.818794/9.586027/10.38676, 0.9120051
    #-rf: 85.19914/51.90656, $10, 15/10, 9.193771/9.921919/10.12282, 0.9175458
    #-xgb: 8.551663/8.887115, -$14, 9/16, 8.905399/9.701911/10.28306, 0.9077574
    #-avg: Inf, $10, 15/10, 8.879686/9.650462/9.831637, 0.9321043
  #-Add F.NBA.SEASON.PLAYER.TRADITIONAL (31/271)
    #-lm: 8.816786/0.5612726, -$2, 12/13, 8.834068/9.534255/10.38203, 0.9325422
    #-rf: 81.8228/53.81245, -$6, 11/14, 9.023319/9.686758/11.83352, 0.9224867
    #-xgb: 8.342935/8.853405, -$14, 9/16, 8.920149/9.693552/11.32844, 0.9130069
    #-avg: Inf, $6, 14/11, 8.836431/9.543674/10.88744, 0.9370972
  #-Add F.RG.PP (63/271)
    #-lm: 8.772657/0.5656534, 8.734317/8.758157, 8.932131/8.758157, 9.140356/8.758157, -$10, 10/15, 8.832806/9.546179/9.90277, 8.92712/9.636422, 0.9177266
    #-rf: 80.26987/54.68904, 3.641312/8.999028, 8.932131/8.999028, 9.140356/8.999028, -$14, 9/16, 8.925519/9.656749/10.53727, 8.92712/9.650876, 0.9113018
    #-xgb: 8.26889/8.819944, 8.277696/8.811168, 8.932131/8.811168, 9.140356/8.811168, -$2, 12/13, 8.881534/9.625615/10.51673, 8.92712/9.663916, 0.9052283
    #-avg: Inf, -$2, 12/13, 8.80162/9.521793/10.58487, 8.92712/9.638649, 0.9019284
    #-.MAX_COV=0.35: lm=-$8 (10/14), rf=-$12 (9/15), xgb=-$12 (9/15), avg=$0 (12/12)
    #-.MAX_COV=0.25: lm=-$8 (6/10), rf=$0 (8/8), xgb=-$8 (6/10), avg=-$12 (5/11)
  #-FP (change MeanFP to take the mean of only games when player played)
    #-lm: 8.773076/0.5656119, -$10, 10/15, 8.833339/9.549135/9.780422, 8.92712/9.638814/9.91537, 0.9152456
    #-rf: 80.80653/54.38611, -$14, 9/16, 8.927661/9.686637/10.60046, 8.92712/9.654794/10.36517, 0.9135077
    #-xgb: 8.294483/8.815681, -$10, 10/15, 8.859432/9.608294/10.04579, 8.92712/9.665075/10.23004, 0.9096953
    #-avg: $6, 14/11, 8.793074/9.533031/10.27711, 8.92712/9.647758/10.4665, 0.9140565
}
dec3FpPerMin = function() {
  #-Fp/Min (FP/Min=RG_FpPerMin, NF_FpPerMin) (Minutes=RG_minutes, NF_Min)
    #-lm:
    #-Model results: FP/Min=0.3263294/0.1583437, Minutes=6.927592/0.5865868, FP=8.772657/0.5656534
    #-Errors:
    #-FP/Min: 0.3263911/0.3258793, 0.3347037/0.3258793, 5.299697/0.3258793
    #-Minutes: 6.995589/6.64174, 7.186872/6.64174, 6.988188/6.64174
    #-FP using FP/Min: 9.057701/9.04586, 8.932131/9.04586, 9.140356/9.04586
    #-FP: 8.734317/8.758157, 8.932131/8.758157, 9.140356/8.758157
    #-Inf, $10, 15/10, 9.17186/9.932789/11.37652, 8.92712/9.570126, 0.9296103
    #-FP: 9.17186/9.932789/11.37652, 8.92712/9.570126/10.42048
    #-FP/Min: 0.3603788/0.2977009/0.3200589, 0.3653742/0.3004967/0.319698
    #-Minutes: 6.833978/6.32717/5.806472, 7.124635/6.609056/6.159289
    #-rf:
    #-Model results: FP/Min=0.1131711/10.53782, Minutes=54.40954/53.12176, FP=80.26987/54.68904
    #-Errors:
    #-FP/Min: 0.1638347/0.332865, 0.3347037/0.332865, 5.299697/0.332865
    #-Minutes: 4.129312/7.037514, 7.186872/7.037514, 6.988188/7.037514
    #-FP using FP/Min: 5.028544/9.452267, 8.932131/9.452267, 9.140356/9.452267
    #-FP: 3.641312/8.999028, 8.932131/8.999028, 9.140356/8.999028
    #-Inf, -$18, 8/17, 9.567574/10.46954/12.04222, 8.92712/9.709872, 0.8728239
    #-FP: 9.567574/10.46954/12.04222, 8.92712/9.709872/10.60838
    #-FP/Min: 0.3689255/0.3101557/0.3185138, 0.3653742/0.2987493/0.2924148
    #-Minutes: 7.218447/6.607721/6.260229, 7.124635/6.469299/5.872324
    #-xgb:
    #-Model results: FP/Min=0.306749/0.31692, Minutes=6.689288/6.921686, FP=8.26889/8.819944
    #-Errors:
    #-FP/Min: 0.3089345/0.3157977, 0.3347037/0.3157977, 5.299697/0.3157977
    #-Minutes: 6.727826/6.611779, 7.186872/6.611779, 6.988188/6.611779
    #-FP using FP/Min: 8.816118/8.966542, 8.932131/8.966542, 9.140356/8.966542
    #-FP: 8.277696/8.811168, 8.932131/8.811168, 9.140356/8.811168
    #-Inf, -$22, 7/18, 9.08395/9.973668/10.02179, 8.92712/9.684731, 0.8759778
    #-FP: 9.08395/9.973668/10.02179, 8.92712/9.684731/10.02436
    #-FP/Min: 0.3513064/0.2900555/0.2814312, 0.3653742/0.2945833/0.2908893
    #-Minutes: 6.845303/6.318898/5.781126, 7.124635/6.500338/6.0254
    #-avg:
    #-Inf, -$18, 8/17, 9.10792/9.973058/10.13355, 8.92712/9.680534, 0.8855454
    #-FP: 9.10792/9.973058/10.13355, 8.92712/9.680534/10.28003
    #-FP/Min: 0.3545333/0.2933866/0.2883741, 0.3653742/0.3026959/0.2968448
    #-Minutes: 6.85744/6.341668/5.325794, 7.124635/6.497567/5.490939
  #-FP/Min (fp/min features='RG_FpPerMin', 'NF_FpPerMin', 'MeanFpPerMin', F.NBA.SEASON.PLAYER.TRADITIONAL, F.RG.PP) (Minutes features=F.RG.PP, 'NF_Min', 'MeanMinutes', F.NBA.SEASON.PLAYER.TRADITIONAL)
    #-lm: 0.3078501/0.250967, 6.843887/0.5965169, -$14, 9/16, 8.8732/9.691727/10.45869, 8.92712/9.719615/10.64115, 0.9107827
    #-rf: 0.09896127/21.77077, 47.87341/58.75317, -$2, 12/13, 8.935262/9.750181/10.39014, 8.92712/9.71691/10.46533, 0.9222803
    #-xgb: 0.289744/0.310105, 6.262178/6.826598, -$10, 10/15, 8.936637/9.74686/10.10323, 8.92712/9.723073/10.14763, 0.8958715
    #-avg: $18, 17/8, 8.831778/9.612751/10.48557, 8.92712/9.689757/10.95288, 0.9333946
  #-FP/Min (Use only players who played >= 5 minutes for train)
    #-lm: 0.2835976/0.2844168, 6.843887/0.5965169, -$10, 10/15, 8.8659/9.6588/10.90075, 8.92712/9.696422/10.94723, 0.9196548
    #-rf: 0.08489405/24.4532, 47.87341/58.75317, -$2, 12/13, 8.913807/9.707628/10.37995, 8.92712/9.704031/10.47206, 0.9402706
    #-xgb: 0.265293/0.287078, 6.262178/6.826598, -$18, 8/17, 8.926717/9.723655/10.02582, 8.92712/9.725257/10.04948, 0.8976389
    #-avg: $10, 15/10, 8.823904/9.619096/11.12592, 8.92712/9.706779/11.51148, 0.9386014

}
dec3 = function() {
#-FP (using only players who played (minutes > 0) in train)
  #-lm: 8.529898/0.5572498, $14, 16/9, 8.889418/9.530822/9.767139, 8.92712/9.630656/9.994823, 0.9472233
  #-rf: 77.20925/53.00823, -$18, 8/17, 9.008532/9.591666/10.43514, 8.92712/9.601598/10.18683, 0.9096342
  #-xgb: 8.03544/8.579351, -$10, 10/15, 8.912601/9.562374/10.66011, 8.92712/9.628253/10.9227, 0.9134139
  #-avg: -$10, 10/15, 8.867623/9.499309/10.49383, 8.92712/9.622424/10.68949, 0.9233465
#-FP/Min (add PrevGameFpPerMin as feature)
  #-lm: 0.2835458/0.2846781, 6.843887/0.5965169, -$14, 9/16, 8.864648/9.654349/10.63728, 8.92712/9.696474/10.768, 0.9128405
  #-rf: 0.0845719/24.73987, 47.87341/58.75317, -$10, 10/15, 8.902686/9.684892/10.11594, 8.92712/9.674423/10.51112, 0.9133617
  #-xgb: 0.265894/0.286838, 6.262178/6.826598, -$14, 9/16, 8.912096/9.697419/9.499563, 8.92712/9.69795/9.493515, 0.9118579
  #-avg: $10, 15/10, 8.816461/9.609102/10.67949, 8.92712/9.703994/11.04303, 0.9259971
#-FpByPlayer (using RG_points, NF_FP, MeanFP)
  #-lm: -$22, 7/18, 9.702675/10.54757/13.08406, 8.92712/9.71835/10.3474, 0.8767937
  #-rf: -$22, 7/18, 9.186798/10.03747/10.69983, 8.92712/9.708439/10.13881, 0.8824331
  #xgb: -$22, 7/18, 10.06826/10.77279/11.6521, 8.92712/9.868881/9.89087, 0.8861515
  #-avg: -$22, 7/18, 9.34987/10.24476/10.58908, 8.92712/9.776938/9.873608, 0.8914785
}